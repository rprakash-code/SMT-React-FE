using System;
using Azure.Identity;
using Azure.Security.KeyVault.Secrets;

public class KeyVaultService
{
    private readonly SecretClient _secretClient;

    public KeyVaultService(string keyVaultUrl)
    {
        // Use Managed Identity to authenticate
        _secretClient = new SecretClient(new Uri(keyVaultUrl), new DefaultAzureCredential());
    }

    public string GetSecret(string secretName)
    {
        try
        {
            // Retrieve the secret from Azure Key Vault
            KeyVaultSecret secret = _secretClient.GetSecret(secretName);
            return secret.Value;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error retrieving secret: {ex.Message}");
            throw;
        }
    }
}

class Program
{
    static void Main(string[] args)
    {
        // Replace with your Key Vault URL
        string keyVaultUrl = "https://<your-key-vault-name>.vault.azure.net/";

        // Replace with your secret name
        string secretName = "MySecretName";

        // Initialize the service
        var keyVaultService = new KeyVaultService(keyVaultUrl);

        // Get the secret value
        string secretValue = keyVaultService.GetSecret(secretName);

        Console.WriteLine($"Retrieved secret value: {secretValue}");
    }
}
