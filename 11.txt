using Azure.Identity;
using Microsoft.Graph;
using System.Net.Http.Headers;
using System.Threading.Tasks;

public class GraphService
{
    private readonly GraphServiceClient _graphClient;

    public GraphService(IConfiguration configuration)
    {
        var clientId = configuration["AzureAd:ClientId"];
        var clientSecret = configuration["AzureAd:ClientSecret"];
        var tenantId = configuration["AzureAd:TenantId"];

        var credential = new ClientSecretCredential(tenantId, clientId, clientSecret);
        var authProvider = new TokenCredentialAuthProvider(credential);

        _graphClient = new GraphServiceClient(authProvider);
    }

    public async Task<User> GetUserDetailsAsync()
    {
        return await _graphClient.Me.Request().GetAsync();
    }
}
